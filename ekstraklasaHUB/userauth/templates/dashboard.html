{% load static %}
<!doctype html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panel - EkstraklasaHUB</title>
    <link rel="stylesheet" href="{% static 'dashboard.css' %}" />
  </head>
  <body>
    <div class="dashboard-container">
      <div class="header-section">
        <h2>EKSTRAKLASA<span style="color: var(--primary-green)">HUB</span></h2>

        <div class="search-container">
          <input
            type="text"
            id="club-search"
            placeholder="Szukaj klubu..."
            autocomplete="off"
          />
          <ul id="search-results"></ul>
        </div>

        <div class="user-info">
          <div class="wallet-display">
            üí∞ <span id="user-balance">...</span> PLN
          </div>
          <span class="user-label">
            Trener: <span class="user-name">{{ username }}</span>
          </span>
          <a href="{% url 'logout' %}" class="btn-logout-small">WYLOGUJ</a>
        </div>
      </div>

      <div class="tile tile-table">
        <div class="tile-header">TABELA LIGOWA</div>
        <div class="tile-content">
          {% if table %}
          <table>
            <thead>
              <tr>
                <th>Poz</th>
                <th>Klub</th>
                <th>M</th>
                <th>PKT</th>
              </tr>
            </thead>
            <tbody>
              {% for row in table %}
              <tr
                class="{% if forloop.first %}pos-1{% elif forloop.counter > 15 %}pos-down{% endif %}"
              >
                <td class="rank-cell">{{ row.intRank }}</td>
                <td>
                  <div class="team-flex">
                    {% if row.strTeamBadge %}<img
                      src="{{ row.strTeamBadge }}"
                      width="20"
                    />{% endif %}
                    <span class="team-truncate">{{ row.strTeam }}</span>
                  </div>
                </td>
                <td class="played-cell">{{ row.intPlayed }}</td>
                <td class="points-cell">{{ row.intPoints }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <p class="no-data">Brak danych.</p>
          {% endif %}
        </div>
      </div>

      <div class="tile tile-matches">
        <div class="tile-header">ZAK≈ÅADY BUKMACHERSKIE & WYNIKI</div>
        <div class="tile-content">
          {% if error %}
          <div class="offline-banner">{{ error }} (Tryb Offline)</div>
          {% endif %}

          <div class="section-divider">Ostatnie Wyniki</div>
          {% if results %}
          <table>
            <tbody>
              {% for match in results %}
              <tr>
                <td class="home-cell">{{ match.strHomeTeam }}</td>
                <td class="center-cell">
                  <span class="score-badge"
                    >{{ match.intHomeScore }}-{{ match.intAwayScore }}</span
                  >
                </td>
                <td class="away-cell">{{ match.strAwayTeam }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% endif %}

          <div class="section-divider">Oferta Zak≈Çad√≥w</div>
          {% if matches %}
          <table>
            <thead>
              <tr>
                <th style="padding-left: 10px">Mecz</th>
                <th style="text-align: center">Czas</th>
                <th style="color: var(--primary-green)">Tw√≥j Kupon</th>
              </tr>
            </thead>
            <tbody>
              {% for match in matches %}
              <tr>
                <td
                  class="home-cell-schedule"
                  style="text-align: left; width: 35%"
                >
                  <div style="display: flex; align-items: center; gap: 5px">
                    {{ match.strHomeTeam }}
                    <span style="color: #666">vs</span> {{ match.strAwayTeam }}
                  </div>
                </td>
                <td class="center-cell" style="width: 15%">
                  <div class="time-main">{{ match.strTime|slice:":5" }}</div>
                </td>
                <td style="width: 50%">
                  <div
                    class="prediction-box"
                    data-match-id="{{ match.idEvent }}"
                    data-home="{{ match.strHomeTeam }}"
                    data-away="{{ match.strAwayTeam }}"
                  >
                    <input
                      type="number"
                      class="pred-input pred-home"
                      placeholder="G"
                      min="0"
                    />
                    <span style="color: #666">:</span>
                    <input
                      type="number"
                      class="pred-input pred-away"
                      placeholder="G"
                      min="0"
                    />
                    <input
                      type="number"
                      class="pred-stake"
                      placeholder="PLN"
                      min="1"
                      step="0.5"
                    />
                    <button
                      class="btn-save-pred"
                      onclick="placeBet('{{ match.idEvent }}')"
                      title="Postaw Zak≈Çad"
                    >
                      ‚úÖ
                    </button>
                    <button
                      class="btn-del-pred"
                      onclick="cancelBet('{{ match.idEvent }}')"
                      title="Wycofaj Zak≈Çad"
                      style="display: none"
                    >
                      üóëÔ∏è
                    </button>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <p class="no-data">Brak mecz√≥w w ofercie.</p>
          {% endif %}
        </div>
      </div>

      <div class="tile tile-scorers tile-fav">
        <div class="tile-header">TW√ìJ KLUB</div>
        {% if favorite_team %}
        <div
          class="fav-bg"
          style="background-image: url('{{ favorite_team.bg }}');"
        ></div>
        <div class="fav-content">
          {% if favorite_team.badge %}
          <img
            src="{{ favorite_team.badge }}"
            alt="{{ favorite_team.name }}"
            class="fav-logo"
          />
          {% endif %}
          <div>
            <h3 class="fav-title">{{ favorite_team.name }}</h3>
            <p class="fav-subtitle">WYBRANY ZESP√ì≈Å</p>
          </div>
          <a href="/club/{{ favorite_team.id }}/stats/" class="fav-btn"
            >Przejd≈∫ do profilu ‚ûú</a
          >
        </div>
        {% else %}
        <div class="fav-empty">
          <span style="font-size: 2rem">‚öΩ</span>
          <p>Nie wybrano ulubionego zespo≈Çu.</p>
        </div>
        {% endif %}
      </div>

      <div class="tile tile-chat">
        <div class="tile-header">TRYBUNA KIBIC√ìW (LIVE)</div>

        <div class="chat-container" id="chat-box">
          <div class="chat-msg">
            <span class="msg-time">System:</span> Witaj na czacie! Dobre maniery
            obowiƒÖzujƒÖ.
          </div>
        </div>

        <div class="chat-controls">
          <div
            style="display: flex; align-items: center; margin-right: 5px"
            title="Wybierz protok√≥≈Ç wysy≈Çania"
          >
            <input
              type="checkbox"
              id="protocol-switch"
              style="accent-color: var(--primary-green)"
            />
            <label
              for="protocol-switch"
              style="
                font-size: 0.7rem;
                color: #888;
                margin-left: 3px;
                cursor: pointer;
              "
              >HTTP</label
            >
          </div>

          <input
            type="text"
            id="chat-input"
            placeholder="Napisz co≈õ..."
            maxlength="60"
          />
          <button class="chat-send-btn" onclick="sendMessage()" title="Wy≈õlij">
            ‚û§
          </button>
        </div>
      </div>
    </div>

    <div id="notifications"></div>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"
      type="text/javascript"
    ></script>

    <script>
      const currentUser = "{{ username }}";
    </script>

    <script src="{% static 'dashboard.js' %}"></script>
  </body>
</html>
